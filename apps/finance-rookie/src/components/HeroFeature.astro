---
import ArticleBadges from "./ArticleBadges.astro";
import ArticleCTA from "./ArticleCTA.astro";
import ArticleMeta from "@theme/components/ArticleMeta.astro";
import { renderKw } from "../lib/kw";

const { article, author, readTime, categoryLabel, secondary = [], getCategoryLabel } = Astro.props;
const heroImage = article.data.hero_image ?? "/images/hero-finanza.svg";
const heroAlt = article.data.hero_alt ?? article.data.title ?? `Immagine su ${categoryLabel}`;
const displayDate =
  article.data.published_at ?? article.data.updatedAt ?? article.data.updated_at ?? new Date().toISOString();
---
<section class="grid gap-10 lg:grid-cols-[1.3fr,0.7fr] lg:items-start">
  <div class="space-y-5">
    <a
      href={`/article/${article.slug}`}
      class="group relative block aspect-[4/3] overflow-hidden border border-border bg-bg-alt focus-visible:outline focus-visible:outline-2 focus-visible:outline-accent focus-visible:outline-offset-2"
      aria-label={`Leggi ${article.data.title}`}
    >
      <img
        src={heroImage}
        alt={heroAlt}
        class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-[1.01]"
        width="1400"
        height="900"
        loading="eager"
      />
    </a>
    <div class="flex flex-wrap items-center gap-3">
      <span class="inline-flex items-center rounded-full border border-border px-3 py-1 text-[0.6rem] font-semibold uppercase tracking-[0.3em]">
        {categoryLabel}
      </span>
      <ArticleBadges article={article} />
    </div>
    <h1 class="font-heading text-5xl leading-[0.95] md:text-6xl">
      <a
        href={`/article/${article.slug}`}
        class="transition-colors hover:text-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-accent focus-visible:outline-offset-2"
      >
        {article.data.title}
      </a>
    </h1>
    <p class="text-lg text-muted">
      {renderKw(article.data.excerpt).map((node) =>
        node.type === "mark" ? <mark class="kw-mark">{node.value}</mark> : node.value
      )}
    </p>
    <ArticleMeta author={author} date={displayDate} readTime={readTime} />
    <ArticleCTA article={article} variant="hero" class="pt-2" />
  </div>
  {secondary.length ? (
    <div class="space-y-5">
      <p class="text-[0.65rem] font-semibold uppercase tracking-[0.35em] text-muted">
        In evidenza
      </p>
      <div class="space-y-4">
        {secondary.map((item) => (
          <a
            href={`/article/${item.slug}`}
            class="group block border border-border bg-white p-4 transition-all duration-200 hover:border-black/30 hover:shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-accent focus-visible:outline-offset-2"
          >
            <div class="flex items-center justify-between text-[0.6rem] uppercase tracking-[0.3em] text-muted">
              <span>{getCategoryLabel?.(item.data.category) ?? item.data.category}</span>
              <ArticleBadges article={item} />
            </div>
            <h3 class="mt-3 font-heading text-xl leading-tight group-hover:underline">
              {item.data.title}
            </h3>
          </a>
        ))}
      </div>
    </div>
  ) : null}
</section>
