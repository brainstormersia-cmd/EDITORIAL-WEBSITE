---
import ArticleBadges from "./ArticleBadges.astro";
import ArticleMeta from "@theme/components/ArticleMeta.astro";
import { renderKw } from "../lib/kw";
import { readingTime } from "@theme/utils/readingTime";

const { items = [], getCategoryLabel, authors } = Astro.props;
---
<section class="section-block bg-bg-alt">
  <div class="container space-y-8">
    <div class="flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
      <div class="flex items-start gap-4">
        <span class="mt-2 h-10 w-[2px] bg-accent" aria-hidden="true"></span>
        <div>
          <p class="text-[0.65rem] font-semibold uppercase tracking-[0.35em] text-muted">
            Trending now
          </p>
          <h2 class="font-heading text-2xl md:text-3xl">
            Le storie che muovono i mercati oggi
          </h2>
        </div>
      </div>
      <a href="/category/trending" class="text-xs uppercase tracking-[0.35em] text-muted hover:text-accent">
        Tutti i trend
      </a>
    </div>
    <div class="grid gap-8 md:grid-cols-3">
      {items.map((article, index) => (
        <article class="group border border-border bg-white transition-all duration-200 hover:-translate-y-1 hover:border-black/30 hover:shadow-sm">
          <a
            href={`/article/${article.slug}`}
            class="flex h-full flex-col p-8 focus-visible:outline focus-visible:outline-2 focus-visible:outline-accent focus-visible:outline-offset-2"
            aria-label={`Leggi ${article.data.title}`}
          >
            <div class="flex items-center justify-between">
              <span class="text-6xl font-semibold text-accent/90 md:text-7xl">
                {String(index + 1).padStart(2, "0")}
              </span>
              <ArticleBadges article={article} />
            </div>
            <p class="mt-4 text-[0.65rem] uppercase tracking-[0.3em] text-muted">
              {getCategoryLabel?.(article.data.category) ?? article.data.category}
            </p>
            <h3 class="mt-3 font-heading text-xl leading-tight group-hover:underline">
              {article.data.title}
            </h3>
            <p class="mt-3 text-sm text-muted">
              {renderKw(article.data.excerpt).map((node) =>
                node.type === "mark" ? <mark class="kw-mark">{node.value}</mark> : node.value
              )}
            </p>
            <div class="mt-auto pt-4">
              <ArticleMeta
                author={authors?.[article.data.author_id]}
                date={article.data.published_at ?? article.data.updatedAt ?? article.data.updated_at}
                readTime={article.data.readingTime ?? readingTime(article.body ?? "")}
                size="compact"
              />
            </div>
          </a>
        </article>
      ))}
    </div>
  </div>
</section>
