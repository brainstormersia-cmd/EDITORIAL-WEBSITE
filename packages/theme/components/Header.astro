---
import LogoMark from "./LogoMark.astro";
import TopTicker from "./TopTicker.astro";
import SearchModal from "./SearchModal.astro";

const { siteConfig } = Astro.props;
const navItems = siteConfig?.nav ?? [];
const currentPath = Astro.url.pathname;
---

<header class="site-header sticky top-0 z-50 border-b border-border bg-bg">
  <TopTicker />

  <div class="header-inner container">
    <div class="header-main">
      <div class="header-brand">
        <LogoMark siteConfig={siteConfig} />
      </div>

      <div class="header-nav-wrap">
        <nav class="header-nav text-xs font-medium uppercase tracking-[0.35em]">
          {navItems.map((item) => {
            const isActive = currentPath === item.href || currentPath.startsWith(`${item.href}/`);
            return (
              <a href={item.href} key={item.href} class={isActive ? "is-active" : undefined}>
                {item.label}
              </a>
            );
          })}
        </nav>

        <button
          class="search-button"
          data-search-trigger
          aria-haspopup="dialog"
          aria-label="Apri la ricerca"
        >
          <span aria-hidden="true">âŒ•</span>
        </button>
      </div>
    </div>
  </div>

  <SearchModal />
</header>

<script>
  const header = document.querySelector(".site-header");
  const onScroll = () => {
    if (!header) return;
    header.classList.toggle("header--scrolled", window.scrollY > 24);
  };
  onScroll();
  window.addEventListener("scroll", onScroll, { passive: true });
</script>
