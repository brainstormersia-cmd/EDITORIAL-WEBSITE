---
import BaseLayout from "../../layouts/BaseLayout.astro";
import SectionHeader from "../../components/SectionHeader.astro";
import PostCard from "../../components/PostCard.astro";
import { getCollection } from "astro:content";
import { getImageByName } from "../../utils/imageMap";
import { slugify } from "../../utils/slug";

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
const categories = Array.from(new Set(posts.map((post) => post.data.category)));
const tags = Array.from(new Set(posts.flatMap((post) => post.data.tags)));
---
<BaseLayout title="Archivio" description="Tutti gli articoli di FinanceRookie.">
  <div class="container py-12 space-y-10">
    <SectionHeader title="Archivio" />
    <div class="flex flex-wrap gap-3 text-xs uppercase tracking-widest">
      {categories.map((category) => (
        <a
          href={`/category/${slugify(category)}`}
          class="border border-border px-3 py-1 hover:border-accent"
        >
          {category}
        </a>
      ))}
      {tags.slice(0, 6).map((tag) => (
        <a href={`/tags/${slugify(tag)}`} class="border border-border px-3 py-1 hover:border-accent">
          {tag}
        </a>
      ))}
    </div>
    <div class="grid gap-6 md:grid-cols-2">
      {posts.map((post) => (
        <PostCard post={post} image={getImageByName(post.data.mainImage)} />
      ))}
    </div>
  </div>
</BaseLayout>
