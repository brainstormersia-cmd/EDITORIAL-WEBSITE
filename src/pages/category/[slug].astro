---
import BaseLayout from "../../layouts/BaseLayout.astro";
import SectionHeader from "../../components/SectionHeader.astro";
import PostCard from "../../components/PostCard.astro";
import { getCollection } from "astro:content";
import { getImageByName } from "../../utils/imageMap";
import { slugify } from "../../utils/slug";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  const categories = Array.from(new Set(posts.map((post) => post.data.category)));
  return categories.map((category) => ({
    params: { slug: slugify(category) },
    props: { category }
  }));
}

const { category } = Astro.props;
const posts = (await getCollection("blog"))
  .filter((post) => post.data.category === category)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---
<BaseLayout title={category} description={`Articoli su ${category} in FinanceRookie.`}>
  <div class="container py-12 space-y-10">
    <SectionHeader title={category} linkText="Archivio" linkHref="/blog" />
    <div class="grid gap-6 md:grid-cols-2">
      {posts.map((post) => (
        <PostCard post={post} image={getImageByName(post.data.mainImage)} />
      ))}
    </div>
  </div>
</BaseLayout>
