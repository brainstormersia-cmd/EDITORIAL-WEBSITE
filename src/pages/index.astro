---
import BaseLayout from "../layouts/BaseLayout.astro";
import HeroFeatured from "../components/HeroFeatured.astro";
import TrendingRail from "../components/TrendingRail.astro";
import ArticleGrid from "../components/ArticleGrid.astro";
import NewsletterBox from "../components/NewsletterBox.astro";
import EditorsPicks from "../components/EditorsPicks.astro";
import { getCollection } from "astro:content";
import { SITE_CONFIG } from "../consts";

const articles = (await getCollection("articles"))
  .filter((article) => !article.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const featuredItems = articles.filter((article) => article.data.featured);
const featured = featuredItems[0] ?? articles[0];
const trending = articles.slice(1, 4);
const latest = articles.slice(0, 6);
const latestPrimary = latest.slice(0, 2);
const latestSecondary = latest.slice(2);
const editorsPicks = articles.slice(2, 5);
const finanza = articles.filter((article) => article.data.category.slug === "finanza").slice(0, 3);
const economia = articles.filter((article) => article.data.category.slug === "economia").slice(0, 3);
const notizie = articles.filter((article) => article.data.category.slug === "notizie").slice(0, 3);
---
<BaseLayout title={SITE_CONFIG.name} description={SITE_CONFIG.description}>
  <div class="container section-block space-y-12">
    {featured && <HeroFeatured article={featured} />}
  </div>

  <section class="trending-rail section-block">
    <div class="container space-y-6">
      <div class="flex items-end justify-between">
        <h2 class="font-heading text-3xl signature-underline font-bold">Trending ora</h2>
        <a href="/blog" class="text-xs uppercase tracking-[0.35em] text-muted hover:text-accent">Archivio</a>
      </div>
      <TrendingRail items={trending} />
    </div>
  </section>

  <section class="section-block">
    <div class="container grid gap-12 lg:grid-cols-[2fr,1fr]">
      <div class="space-y-8">
        <div class="flex items-end justify-between">
          <h2 class="font-heading text-3xl signature-underline font-bold">Ultimi articoli</h2>
          <a href="/blog" class="text-xs uppercase tracking-[0.35em] text-muted hover:text-accent">Vedi tutti</a>
        </div>
        <div class="space-y-6">
          <ArticleGrid articles={latestPrimary} variant="featured" />
          <NewsletterBox class="lg:hidden" />
          <ArticleGrid articles={latestSecondary} />
        </div>
      </div>
      <aside class="hidden lg:block space-y-6 sticky top-28 self-start">
        <NewsletterBox />
        <EditorsPicks items={editorsPicks} />
      </aside>
    </div>
  </section>

  <section class="section-block">
    <div class="container grid gap-6 lg:grid-cols-3">
      <div class="border border-border p-6 space-y-4">
        <h3 class="font-heading text-2xl signature-underline">Finanza</h3>
        <ul class="space-y-3 text-sm">
          {finanza.map((article) => (
            <li key={article.slug}>
              <a href={`/article/${article.slug}`} class="hover:underline">{article.data.title}</a>
            </li>
          ))}
        </ul>
        <a href="/category/finanza" class="text-xs uppercase tracking-[0.35em] text-muted hover:text-accent">
          Vedi tutti
        </a>
      </div>
      <div class="border border-border p-6 space-y-4">
        <h3 class="font-heading text-2xl signature-underline">Economia</h3>
        <ul class="space-y-3 text-sm">
          {economia.map((article) => (
            <li key={article.slug}>
              <a href={`/article/${article.slug}`} class="hover:underline">{article.data.title}</a>
            </li>
          ))}
        </ul>
        <a href="/category/economia" class="text-xs uppercase tracking-[0.35em] text-muted hover:text-accent">
          Vedi tutti
        </a>
      </div>
      <div class="border border-border p-6 space-y-4">
        <h3 class="font-heading text-2xl signature-underline">Notizie</h3>
        <ul class="space-y-3 text-sm">
          {notizie.map((article) => (
            <li key={article.slug}>
              <a href={`/article/${article.slug}`} class="hover:underline">{article.data.title}</a>
            </li>
          ))}
        </ul>
        <a href="/category/notizie" class="text-xs uppercase tracking-[0.35em] text-muted hover:text-accent">
          Vedi tutti
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
